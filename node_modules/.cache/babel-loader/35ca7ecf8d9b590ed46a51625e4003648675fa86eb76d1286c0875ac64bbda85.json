{"ast":null,"code":"import { supabase } from '../lib/supabase';\nexport const orderService = {\n  // Criar um novo pedido\n  async createOrder(orderData) {\n    try {\n      // Primeiro, inserir o pedido principal\n      const {\n        data: pedido,\n        error: pedidoError\n      } = await supabase.from('pedidos').insert([{\n        cliente_nome: orderData.customer.name,\n        telefone: orderData.customer.phone,\n        cidade: orderData.customer.address.city,\n        rua: orderData.customer.address.street,\n        numero: orderData.customer.address.number,\n        bairro: orderData.customer.address.neighborhood,\n        observacoes: orderData.customer.notes,\n        total_pedido: orderData.total,\n        status: 'pendente'\n      }]).select().single();\n      if (pedidoError) {\n        throw pedidoError;\n      }\n\n      // Depois, inserir os itens do pedido\n      const pedidoItens = orderData.items.map(item => ({\n        pedido_id: pedido.id,\n        material_id: item.materialId,\n        veiculo_id: item.vehicleId,\n        quantidade: item.quantity,\n        preco_unitario: item.unitPrice,\n        total_item: item.totalPrice\n      }));\n      const {\n        error: itensError\n      } = await supabase.from('pedido_itens').insert(pedidoItens);\n      if (itensError) {\n        throw itensError;\n      }\n      return {\n        success: true,\n        order: pedido\n      };\n    } catch (error) {\n      console.error('Erro ao criar pedido:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  },\n  // Buscar todos os pedidos com joins\n  async getOrders() {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('pedidos').select(`\n          *,\n          pedido_itens (\n            *,\n            materiais (nome, tipo_medida),\n            veiculos (nome, capacidade)\n          )\n        `).order('created_at', {\n        ascending: false\n      });\n      if (error) {\n        throw error;\n      }\n      return {\n        success: true,\n        data\n      };\n    } catch (error) {\n      console.error('Erro ao buscar pedidos:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  },\n  // Buscar pedidos pendentes\n  async getPendingOrders() {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('pedidos').select(`\n          *,\n          pedido_itens (\n            *,\n            materiais (nome, tipo_medida),\n            veiculos (nome, capacidade)\n          )\n        `).eq('status', 'pendente').order('created_at', {\n        ascending: false\n      });\n      if (error) {\n        throw error;\n      }\n      return {\n        success: true,\n        data\n      };\n    } catch (error) {\n      console.error('Erro ao buscar pedidos pendentes:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  },\n  // Buscar itens por veículo (para entregadores)\n  async getItemsByVehicle(vehicleId) {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('pedido_itens').select(`\n          *,\n          pedidos!inner (\n            id, cliente_nome, telefone, cidade, rua, numero, bairro, observacoes, status\n          ),\n          materiais (nome, tipo_medida),\n          veiculos (nome, capacidade)\n        `).eq('veiculo_id', vehicleId).eq('pedidos.status', 'pendente').order('pedidos.created_at', {\n        ascending: false\n      });\n      if (error) {\n        throw error;\n      }\n      return {\n        success: true,\n        data\n      };\n    } catch (error) {\n      console.error('Erro ao buscar itens por veículo:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  },\n  // Atualizar status do pedido\n  async updateOrderStatus(orderId, status) {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('pedidos').update({\n        status\n      }).eq('id', orderId).select().single();\n      if (error) {\n        throw error;\n      }\n      return {\n        success: true,\n        data\n      };\n    } catch (error) {\n      console.error('Erro ao atualizar status:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  },\n  // Buscar pedido por ID\n  async getOrderById(orderId) {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('pedidos').select(`\n          *,\n          pedido_itens (\n            *,\n            materiais (nome, tipo_medida),\n            veiculos (nome, capacidade)\n          )\n        `).eq('id', orderId).single();\n      if (error) {\n        throw error;\n      }\n      return {\n        success: true,\n        data\n      };\n    } catch (error) {\n      console.error('Erro ao buscar pedido:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  }\n};","map":{"version":3,"names":["supabase","orderService","createOrder","orderData","data","pedido","error","pedidoError","from","insert","cliente_nome","customer","name","telefone","phone","cidade","address","city","rua","street","numero","number","bairro","neighborhood","observacoes","notes","total_pedido","total","status","select","single","pedidoItens","items","map","item","pedido_id","id","material_id","materialId","veiculo_id","vehicleId","quantidade","quantity","preco_unitario","unitPrice","total_item","totalPrice","itensError","success","order","console","message","getOrders","ascending","getPendingOrders","eq","getItemsByVehicle","updateOrderStatus","orderId","update","getOrderById"],"sources":["C:/Users/Administrator/Downloads/estudos/estudos/Gh/src/services/orderService.js"],"sourcesContent":["import { supabase } from '../lib/supabase'\r\n\r\nexport const orderService = {\r\n  // Criar um novo pedido\r\n  async createOrder(orderData) {\r\n    try {\r\n      // Primeiro, inserir o pedido principal\r\n      const { data: pedido, error: pedidoError } = await supabase\r\n        .from('pedidos')\r\n        .insert([\r\n          {\r\n            cliente_nome: orderData.customer.name,\r\n            telefone: orderData.customer.phone,\r\n            cidade: orderData.customer.address.city,\r\n            rua: orderData.customer.address.street,\r\n            numero: orderData.customer.address.number,\r\n            bairro: orderData.customer.address.neighborhood,\r\n            observacoes: orderData.customer.notes,\r\n            total_pedido: orderData.total,\r\n            status: 'pendente'\r\n          }\r\n        ])\r\n        .select()\r\n        .single()\r\n\r\n      if (pedidoError) {\r\n        throw pedidoError\r\n      }\r\n\r\n      // Depois, inserir os itens do pedido\r\n      const pedidoItens = orderData.items.map(item => ({\r\n        pedido_id: pedido.id,\r\n        material_id: item.materialId,\r\n        veiculo_id: item.vehicleId,\r\n        quantidade: item.quantity,\r\n        preco_unitario: item.unitPrice,\r\n        total_item: item.totalPrice\r\n      }))\r\n\r\n      const { error: itensError } = await supabase\r\n        .from('pedido_itens')\r\n        .insert(pedidoItens)\r\n\r\n      if (itensError) {\r\n        throw itensError\r\n      }\r\n\r\n      return { success: true, order: pedido }\r\n    } catch (error) {\r\n      console.error('Erro ao criar pedido:', error)\r\n      return { success: false, error: error.message }\r\n    }\r\n  },\r\n\r\n  // Buscar todos os pedidos com joins\r\n  async getOrders() {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('pedidos')\r\n        .select(`\r\n          *,\r\n          pedido_itens (\r\n            *,\r\n            materiais (nome, tipo_medida),\r\n            veiculos (nome, capacidade)\r\n          )\r\n        `)\r\n        .order('created_at', { ascending: false })\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { success: true, data }\r\n    } catch (error) {\r\n      console.error('Erro ao buscar pedidos:', error)\r\n      return { success: false, error: error.message }\r\n    }\r\n  },\r\n\r\n  // Buscar pedidos pendentes\r\n  async getPendingOrders() {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('pedidos')\r\n        .select(`\r\n          *,\r\n          pedido_itens (\r\n            *,\r\n            materiais (nome, tipo_medida),\r\n            veiculos (nome, capacidade)\r\n          )\r\n        `)\r\n        .eq('status', 'pendente')\r\n        .order('created_at', { ascending: false })\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { success: true, data }\r\n    } catch (error) {\r\n      console.error('Erro ao buscar pedidos pendentes:', error)\r\n      return { success: false, error: error.message }\r\n    }\r\n  },\r\n\r\n  // Buscar itens por veículo (para entregadores)\r\n  async getItemsByVehicle(vehicleId) {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('pedido_itens')\r\n        .select(`\r\n          *,\r\n          pedidos!inner (\r\n            id, cliente_nome, telefone, cidade, rua, numero, bairro, observacoes, status\r\n          ),\r\n          materiais (nome, tipo_medida),\r\n          veiculos (nome, capacidade)\r\n        `)\r\n        .eq('veiculo_id', vehicleId)\r\n        .eq('pedidos.status', 'pendente')\r\n        .order('pedidos.created_at', { ascending: false })\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { success: true, data }\r\n    } catch (error) {\r\n      console.error('Erro ao buscar itens por veículo:', error)\r\n      return { success: false, error: error.message }\r\n    }\r\n  },\r\n\r\n  // Atualizar status do pedido\r\n  async updateOrderStatus(orderId, status) {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('pedidos')\r\n        .update({ status })\r\n        .eq('id', orderId)\r\n        .select()\r\n        .single()\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { success: true, data }\r\n    } catch (error) {\r\n      console.error('Erro ao atualizar status:', error)\r\n      return { success: false, error: error.message }\r\n    }\r\n  },\r\n\r\n  // Buscar pedido por ID\r\n  async getOrderById(orderId) {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('pedidos')\r\n        .select(`\r\n          *,\r\n          pedido_itens (\r\n            *,\r\n            materiais (nome, tipo_medida),\r\n            veiculos (nome, capacidade)\r\n          )\r\n        `)\r\n        .eq('id', orderId)\r\n        .single()\r\n\r\n      if (error) {\r\n        throw error\r\n      }\r\n\r\n      return { success: true, data }\r\n    } catch (error) {\r\n      console.error('Erro ao buscar pedido:', error)\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}